<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisaFlow Analytics | Advanced Immigration Dashboard</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700;900&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- External Libraries -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three-globe"></script>
    
    <!-- Date range picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body data-theme="light">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loader">
            <div class="loader-circle"></div>
            <p>Loading visa data...</p>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <a href="#" class="brand-logo">
                    <div class="brand-icon">üéì</div>
                    <div class="brand-text">VisaFlow</div>
                </a>
            </div>
            
            <nav class="sidebar-nav">
                <ul class="sidebar-menu">
                    <li class="menu-item">
                        <a href="#" class="menu-link active" data-section="overview">
                            <div class="menu-icon">üìä</div>
                            <span>Overview</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="demographics">
                            <div class="menu-icon">üë•</div>
                            <span>Demographics</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="geographic">
                            <div class="menu-icon">üåç</div>
                            <span>Global Flow</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="funnel">
                            <div class="menu-icon">üîÑ</div>
                            <span>Application Flow</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="forecast">
                            <div class="menu-icon">üìà</div>
                            <span>Future Trends</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="main-wrapper">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <h1 class="page-title">Temporary Graduate Visa Analytics</h1>
                    <p class="page-subtitle">Comprehensive insights into Australian visa applications</p>
                </div>
                <div class="header-controls">
                    <input type="text" id="date-range" class="date-range-picker" placeholder="Select date range">
                    <select id="year-filter" class="year-filter">
                        <option value="all">üìä All Years (2007-2024)</option>
                        <option value="recent">üî• Recent (2020-2024)</option>
                        <option value="decade">üìà Last Decade (2014-2024)</option>
                        <option value="custom">üìÖ Custom Range</option>
                    </select>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Overview Section -->
                <section id="overview-section" class="content-section active">
                    <!-- Stats Cards -->
                    <div class="dashboard-grid">
                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="stat-value" id="total-lodged-counter">0</div>
                                <div class="stat-label">Total Applications</div>
                                <div class="stat-trend trend-positive">
                                    <span class="trend-icon">‚Üó</span>
                                    <span>+16k vs last month</span>
                                </div>
                            </div>
                        </div>

                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="stat-value" id="total-granted-counter">0</div>
                                <div class="stat-label">Visas Granted</div>
                                <div class="stat-trend trend-positive">
                                    <span class="trend-icon">‚Üó</span>
                                    <span>+12k vs last month</span>
                                </div>
                            </div>
                        </div>

                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="stat-value" id="success-rate-counter">0<span style="font-size: 18px;">%</span></div>
                                <div class="stat-label">Success Rate</div>
                                <div class="stat-trend trend-positive">
                                    <span class="trend-icon">‚Üó</span>
                                    <span>+2.3% vs last year</span>
                                </div>
                            </div>
                        </div>

                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="stat-value" id="total-rejected-counter">0</div>
                                <div class="stat-label">Applications Rejected</div>
                                <div class="stat-trend trend-negative">
                                    <span class="trend-icon">‚Üò</span>
                                    <span>-5% vs last year</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chart Section -->
                    <div class="card chart-card card-wide">
                        <div class="card-header">
                            <h3 class="card-title">Application Trends Over Time</h3>
                            <p class="card-subtitle">Visa applications and approvals by financial year</p>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="overview-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- New Visualizations Row -->
                    <div class="dashboard-grid">
                        <!-- Waterfall Chart -->
                        <div class="card chart-card">
                            <div class="card-header">
                                <h3 class="card-title">Application Pipeline</h3>
                                <p class="card-subtitle">From lodged to final decision</p>
                            </div>
                            <div class="card-body">
                                <div id="waterfall-chart" style="height: 300px;"></div>
                            </div>
                        </div>
                        
                        <!-- Calendar Heatmap -->
                        <div class="card chart-card">
                            <div class="card-header">
                                <h3 class="card-title">Daily Activity</h3>
                                <p class="card-subtitle">Application patterns over time</p>
                            </div>
                            <div class="card-body">
                                <div id="calendar-heatmap" style="height: 300px; overflow-x: auto;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bump Chart -->
                    <div class="card chart-card card-wide">
                        <div class="card-header">
                            <h3 class="card-title">Top Countries Rankings Over Time</h3>
                            <p class="card-subtitle">See how countries rise and fall in application volumes</p>
                        </div>
                        <div class="card-body">
                            <div id="bump-chart" style="height: 360px;"></div>
                        </div>
                    </div>
                </section>

                <!-- Demographics Section -->
                <section id="demographics-section" class="content-section">
                    <div class="demographics-section">
                        <div class="demographics-main">
                            <div class="visualization-tabs">
                                <button class="viz-tab active" data-viz="treemap">Treemap</button>
                                <button class="viz-tab" data-viz="chord">Flow Diagram</button>
                            </div>
                            <div id="treemap-view" class="viz-content active">
                                <h3 class="card-title">Top Countries by Applications</h3>
                                <p class="card-subtitle" style="margin-bottom: 1rem;">Visualization of applicant countries by volume</p>
                                <div class="treemap-container">
                                    <div id="treemap-container"></div>
                                </div>
                            </div>
                            <div id="chord-view" class="viz-content">
                                <h3 class="card-title">Country to Decision Flow</h3>
                                <p class="card-subtitle" style="margin-bottom: 1rem;">Interactive flow from countries to visa decisions</p>
                                <div id="chord-diagram" style="height: 500px;"></div>
                            </div>
                        </div>

                        <div class="demographics-sidebar">
                            <div class="mini-card">
                                <div class="mini-card-icon blue">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                                <div class="mini-card-value" id="gender-male-count">0</div>
                                <div class="mini-card-label">Male Applicants</div>
                            </div>

                            <div class="mini-card">
                                <div class="mini-card-icon orange">üë©‚Äçüíº</div>
                                <div class="mini-card-value" id="gender-female-count">0</div>
                                <div class="mini-card-label">Female Applicants</div>
                            </div>

                            <div class="card chart-card">
                                <div class="card-header">
                                    <h4 class="card-title">Applicant Type</h4>
                                </div>
                                <div class="card-body">
                                    <canvas id="applicant-type-chart" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Geographic Section -->
                <section id="geographic-section" class="content-section">
                    <div class="visualization-tabs">
                        <button class="viz-tab active" data-viz="map2d">2D Map</button>
                        <button class="viz-tab" data-viz="globe3d">3D Globe</button>
                    </div>
                    
                    <div id="map2d-view" class="viz-content active">
                        <div class="map-section">
                            <div class="card-header">
                                <h3 class="card-title">Global Application Distribution</h3>
                                <p class="card-subtitle">Interactive world map showing visa application volumes by country</p>
                            </div>
                            <div id="world-map" class="world-map"></div>
                            <div class="map-legend">
                                <h4>Application Volume</h4>
                                <div class="legend-gradient" style="background: linear-gradient(to right, #fef3c7, #f59e0b, #d97706, #92400e); width: 120px; height: 8px; border-radius: 4px; margin-bottom: 4px;"></div>
                                <div class="legend-labels" style="display: flex; justify-content: space-between; font-size: 10px; color: var(--text-secondary);">
                                    <span>Low</span>
                                    <span>High</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="globe3d-view" class="viz-content">
                        <div class="map-section">
                            <div class="card-header">
                                <h3 class="card-title">Migration Flows to Australia</h3>
                                <p class="card-subtitle">3D visualization of visa application origins</p>
                            </div>
                            <div id="globe-container" style="height: 520px;"></div>
                        </div>
                    </div>
                    
                    <div id="country-tooltip" class="tooltip"></div>
                    
                    <!-- Processing Time Distribution -->
                    <div class="card chart-card card-wide" style="margin-top: 2rem;">
                        <div class="card-header">
                            <h3 class="card-title">Processing Time Distributions</h3>
                            <p class="card-subtitle">Compare processing times across top countries</p>
                        </div>
                        <div class="card-body">
                            <div id="ridgeline-chart" style="height: 440px;"></div>
                        </div>
                    </div>
                </section>

                <!-- Funnel Section -->
                <section id="funnel-section" class="content-section">
                    <div class="sankey-section">
                        <div class="card-header">
                            <h3 class="card-title">Application Flow Analysis</h3>
                            <p class="card-subtitle">From application submission to final decision outcome</p>
                        </div>
                        <div id="sankey-container" class="sankey-container"></div>
                    </div>
                </section>

                <!-- Forecast Section -->
                <section id="forecast-section" class="content-section">
                    <div class="card chart-card card-wide">
                        <div class="card-header">
                            <h3 class="card-title">Future Projections</h3>
                            <p class="card-subtitle">Historical trends and forecasted visa applications</p>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="forecast-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="insights-panel">
                        <h3>Key Insights & Trends</h3>
                        <div id="insights-content" class="insights-content">
                            <ul>
                                <li>Strong recovery trend post-COVID with 15% year-over-year growth</li>
                                <li>China and India continue to dominate application volumes (60% combined)</li>
                                <li>Success rates have improved to 85.3% indicating effective policy changes</li>
                                <li>Emerging markets showing increased interest in Australian education</li>
                                <li>Projected 25% growth in applications over the next 3 years</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/advanced-charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>